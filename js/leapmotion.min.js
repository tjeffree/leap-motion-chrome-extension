(function(){function L(a,b){function c(){f.stop||((new Date).getTime()-d>=b&&(a.call(),d=(new Date).getTime()),f.value=requestAnimationFrame(c))}var d=(new Date).getTime(),f={stop:!1};f.value=requestAnimationFrame(c);return f}function A(a){a.stop=!0;window.cancelAnimationFrame(a.value)}function B(){if(m.fingers===t){var a=document.createElement("div"),b=document.createElement("div"),c,d;a.id="chrome-leap-fingercontainer";for(d=0;10>d;d++)c=b.cloneNode(),c.id="chrome-leap-finger"+(d+1),"rainbow"===
m.color&&(c.style.cssText="background-color: "+M[d]+";"),c.className="chrome-leap-finger chrome-leap-finger-"+m.color,a.appendChild(c);g=document.createElement("div");h=document.createElement("div");g.id="chrome-leap-scroll-down";h.id="chrome-leap-scroll-up";a.appendChild(g);a.appendChild(h);document.body.appendChild(a);k=document.getElementsByClassName("chrome-leap-finger");g=document.getElementById("chrome-leap-scroll-down");h=document.getElementById("chrome-leap-scroll-up")}u=L(N,1E3)}function N(){v?
(O(),P()):A(u)}function O(){C=Date.now()/1E3;if(null!==w&&C-w>Q)if(10>x)x++,console.log("Disconnected from Leap Motion - attempting reconnect ("+x+"/10)"),D();else{A(u);v=!1;try{"runtime"in chrome?chrome.runtime.sendMessage({connection:"lost"},function(a){console.error("Connection to Leap Motion Lost. Restart Leap Motion and Refresh Page.");var c=document.createElement("div");c.className="leap_motion_connection";c.innerHTML="<b>ATTENTION:</b> Connection to Leap Motion Lost. Restart Leap Motion and Refresh Page.";
document.body.appendChild(c);document.getElementsByClassName("leap_motion_connection")[0].addEventListener("click",function(){this.style.display="none"},!1);setTimeout(function(){c.parentNode.removeChild(c)},2E4)}):console.error("Connection to Leap Motion Lost. Restart Leap Motion and Refresh Page.")}catch(a){console.error(a.message)}}}function P(){if("runtime"in chrome)try{chrome.runtime.sendMessage({tab_status:"current"},function(a){n=a.active&&window.location.href==a.url&&document.hasFocus()?!0:
!1})}catch(a){-1!==a.message.indexOf("Error connecting to extension")?refresh_page():console.error(a.message)}else n=document.hasFocus()}function E(){if(m.fingers===t&&(g.style.display="none",h.style.display="none",void 0!==k[0]))for(var a=0;10>a;a++)k[a].style.opacity=0}function R(a,b){if(m.scrolling!==F&&void 0!==b.pointablesMap&&0!==a.pointableIds.length&&void 0!==b.pointablesMap[a.pointableIds[0]]&&"direction"in b.pointablesMap[a.pointableIds[0]]){var c;c=S;c=new y(b.finger(a.pointableIds[0]).direction);
a.isClockwise=c.angleTo(new y(a.normal))<=Math.PI/4;null==e||a.isClockwise!==e.isClockwise||a.id!==e.id?e=a:(c=a.radius/2,c*=b.fingers.length,10>c&&(c=10),c*=10*(a.progress-e.progress),100<c||0>=c?e=a:(clearTimeout(G),p=a.pointableIds[0],a.isClockwise?q="down":(c=-c,q="up"),window.scrollBy(0,c,"smooth"),e="stop"===a.state?null:a,G=setTimeout(function(){p=q=null;g.style.display="none";h.style.display="none"},200)))}}function T(a,b){0===a.handIds.length||(!z||m.history===F)||100>Math.abs(a.position[0]-
a.startPosition[1])||(0<a.direction[0]?history.forward():history.back(),z=!1,setTimeout(function(){z=!0},300))}function H(){"storage"in chrome?chrome.storage.local.get(["leap_motion_fingers","leap_motion_color","leap_motion_scrolling","leap_motion_history"],function(a){for(var b in a)if("undefined"!==typeof a[b]){var c=b.substr(b.lastIndexOf("_")+1);m[c]=a[b]}B()}):B()}function D(){void 0!==l&&("connected"in l&&l.connected)&&(l.disconnect(),l=null);l=new Leap.Controller({enableGestures:!0});l.on("frame",
function(){var a=l.frame(0);if(v){var b;w=Date.now()/1E3;if("yes"===m.fingers&&n){if(b=0<a.hands.length&&"undefined"!==a.hands[0]._scaleFactor?a.hands[0]._scaleFactor:1,!I&&(E(),b=Math.ceil(d*b),Math.ceil(b/2),void 0!==k[0]&&0<a.fingers.length)){b=0;for(var c=a.fingers.length,e,f;b<c&&10>b;b++)if(null===p||p===a.fingers[b].id)e=J/2+a.fingers[b].tipPosition[0],f=K/2-a.fingers[b].tipPosition[1],k[b].style.top="0",k[b].style.left="0",k[b].style.transform="translate3d("+e.toFixed(2)+"px, "+f.toFixed(2)+
"px, 0)",k[b].style.webkitTransform="translate3d("+e.toFixed(2)+"px, "+f.toFixed(2)+"px, 0)",k[b].style.opacity=0.5,p===a.fingers[b].id&&("down"===q?(g.style.transform="translate3d("+e.toFixed(2)+"px, "+(f+d+5)+"px, 0)",g.style.webkitTransform="translate3d("+e.toFixed(2)+"px, "+(f+d+5)+"px, 0)",g.style.display="block",g.style.borderTopColor=k[b].style.backgroundColor):"up"===q?(h.style.transform="translate3d("+e.toFixed(2)+"px, "+(f-d+5)+"px, 0)",h.style.webkitTransform="translate3d("+e.toFixed(2)+
"px, "+(f-d+5)+"px, 0)",h.style.display="block",h.style.borderBottomColor=k[b].style.backgroundColor):(g.style.display="none",h.style.display="none"))}}else I||E();if(void 0!==a.pointables&&n){if(r=a.gestures&&0<a.gestures.length?"gesture":null,null!==r)switch(r){case "gesture":b=a.gestures[0];if("circle"===b.type){R(b,a);break}"swipe"===b.type&&"stop"===b.state&&T(b,a)}}else r=null}});l.connect()}function y(a){null==a?this.z=this.y=this.x=0:"x"in a?(this.x=a.x,this.y=a.y,this.z=a.z):"0"in a&&(this.x=
"number"==typeof a[0]?a[0]:0,this.y="number"==typeof a[1]?a[1]:0,this.z="number"==typeof a[2]?a[2]:0)}var F="disabled",t="yes",n=!1,v=!0,r=null,x=0,C,w=null,u,Q=5,J=window.innerWidth,K=window.innerHeight,S=15,q=null,G=null,p=null,z=!0,d=20,M="#F80C12 #FF3311 #FF6644 #FEAE2D #D0C310 #69D025 #12BDB9 #4444DD #3B0CBD #442299".split(" "),k=[],I=!1,g,h,e=null,s,l,m={fingers:t,color:"rainbow",scrolling:"enabled",history:"enabled"},U=".leap_motion_connection {position: fixed;top: 0;left: 0;width: 100%;color: #222;text-align: center;height: 30px;z-index: 1000;line-height: 30px;background-color: #9AC847; }.chrome-leap-finger {width:"+
d+"px;height:"+d+"px;-webkit-border-radius: "+Math.ceil(d/2)+"px;border-radius: "+Math.ceil(d/2)+"px;position: fixed;z-index: 10000;opacity: 0;-webkit-transition: opacity 0.15s ease;transition: opacity 0.15s ease;-webkit-box-sizing: border-box;box-sizing: border-box;transform: translate3d(0,0,0); }.chrome-leap-finger-rainbow {-webkit-box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25);box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25); }.chrome-leap-finger-leap {background-color: #9AC847;-webkit-box-shadow: inset 0 0 5px #000;box-shadow: inner 0 0 5px #000; }.chrome-leap-finger-dark {background-color: #000000;-webkit-box-shadow: inset 0px 0px 1px 1px rgba(255, 255, 255, 0.5);box-shadow: inset 0px 0px 1px 1px rgba(255, 255, 255, 0.5); }.chrome-leap-finger-light {background-color: #FFFFFF;-webkit-box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25);box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25) }#chrome-leap-scroll-up {display: none; position: fixed; top:0; left:0;width: 0; height: 0;opacity: 0.5;margin-left: "+
d/2/2+"px;border-left: "+d/2/2+"px solid transparent;border-right: "+d/2/2+"px solid transparent;border-bottom: "+d/2+"px solid #9AC847; }#chrome-leap-scroll-down {display: none; position: fixed; top:0; left:0;width: 0; height: 0;opacity: 0.5;margin-left: "+d/2/2+"px;border-left: "+d/2/2+"px solid transparent;border-right: "+d/2/2+"px solid transparent;border-top: "+d/2+"px solid #9AC847; }";y.prototype={angleTo:function(a){var b=this.magnitude()*a.magnitude();return 0<b?Math.acos(this.dot(a)/b):
0},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},magnitude:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}};s=document.createElement("style");s.setAttribute("type","text/css");s.appendChild(document.createTextNode(U));document.head.appendChild(s);H();"storage"in chrome&&chrome.storage.onChanged.addListener(H);(function(){window.addEventListener("resize",function(){J=window.innerWidth;K=window.innerHeight},!1);window.addEventListener("focus",function(){n=
!0});window.addEventListener("blur",function(){n=!1})})();D()})();