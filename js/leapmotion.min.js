(function(){function w(a){null===a?this.z=this.y=this.x=0:"x"in a?(this.x=a.x,this.y=a.y,this.z=a.z):"0"in a&&(this.x="number"===typeof a[0]?a[0]:0,this.y="number"===typeof a[1]?a[1]:0,this.z="number"===typeof a[2]?a[2]:0)}function L(a,b){function c(){d.stop||((new Date).getTime()-k>=b&&(a.call(),k=(new Date).getTime()),d.value=requestAnimationFrame(c))}var k=(new Date).getTime(),d={stop:!1};d.value=requestAnimationFrame(c);return d}function B(a){a.stop=!0;window.cancelAnimationFrame(a.value)}function C(){if(m.fingers===
s){var a;f.style.display="none";g.style.display="none";if(void 0!==h[0])for(a=0;10>a;a+=1)h[a].style.opacity=0}}function M(a,b){if(m.scrolling!==D&&void 0!==b.pointablesMap&&0!==a.pointableIds.length&&void 0!==b.pointablesMap[a.pointableIds[0]]&&"direction"in b.pointablesMap[a.pointableIds[0]]){var c;c=N;c=new w(b.finger(a.pointableIds[0]).direction);a.isClockwise=c.angleTo(new w(a.normal))<=Math.PI/4;null===e||a.isClockwise!==e.isClockwise||a.id!==e.id?e=a:(c=a.radius/2,c*=b.fingers.length,10>c&&
(c=10),c*=10*(a.progress-e.progress),100<c||0>=c?e=a:(clearTimeout(E),q=a.pointableIds[0],a.isClockwise?r="down":(c=-c,r="up"),window.scrollBy(0,c,"smooth"),e="stop"===a.state?null:a,E=setTimeout(function(){q=r=null;n||(f.style.display="none",g.style.display="none")},200)))}}function O(a){0===a.handIds.length||!x||m.history===D||100>Math.abs(a.position[0]-a.startPosition[1])||(0<a.direction[0]?history.forward():history.back(),x=!1,setTimeout(function(){x=!0},300))}function F(){void 0!==l&&"connected"in
l&&l.connected&&(l.disconnect(),l=null);l=new Leap.Controller({enableGestures:!0});l.on("frame",function(){var a=l.frame(0),b;if(y){z=b=Date.now()/1E3;if(m.fingers===s&&p){if(!n){C();var c=a.fingers.length,k,e;if(void 0===h[0])n=!0;else if(0<a.fingers.length)for(n=!1,b=0;b<c&&10>b;b+=1)if(null===q||q===a.fingers[b].id)k=G/2+a.fingers[b].tipPosition[0],e=H/2-a.fingers[b].tipPosition[1],h[b].style.top="0",h[b].style.left="0",h[b].style.transform="translate3d("+k.toFixed(2)+"px, "+e.toFixed(2)+"px, 0)",
h[b].style.webkitTransform="translate3d("+k.toFixed(2)+"px, "+e.toFixed(2)+"px, 0)",h[b].style.opacity=0.5,q===a.fingers[b].id&&("down"===r?(f.style.transform="translate3d("+k.toFixed(2)+"px, "+(e+d+5)+"px, 0)",f.style.webkitTransform="translate3d("+k.toFixed(2)+"px, "+(e+d+5)+"px, 0)",f.style.display="block",f.style.borderTopColor=h[b].style.backgroundColor):"up"===r?(g.style.transform="translate3d("+k.toFixed(2)+"px, "+(e-d+5)+"px, 0)",g.style.webkitTransform="translate3d("+k.toFixed(2)+"px, "+
(e-d+5)+"px, 0)",g.style.display="block",g.style.borderBottomColor=h[b].style.backgroundColor):(f.style.display="none",g.style.display="none"))}}else n||C();if(void 0!==a.pointables&&p){if(t=a.gestures&&0<a.gestures.length?"gesture":null,null!==t)switch(t){case "gesture":b=a.gestures[0];if("circle"===b.type){M(b,a);break}"swipe"===b.type&&"stop"===b.state&&O(b)}}else t=null}});l.connect()}function P(){I=Date.now()/1E3;if(null!==z&&I-z>Q)if(10>u)u+=1,console.log("Disconnected from Leap Motion - attempting reconnect ("+
u+"/10)"),F();else{B(A);y=!1;try{"runtime"in chrome?chrome.runtime.sendMessage({connection:"lost"},function(){console.error("Connection to Leap Motion Lost. Restart Leap Motion and Refresh Page.");var a=document.createElement("div");a.className="leap_motion_connection";a.innerHTML="<b>ATTENTION:</b> Connection to Leap Motion Lost. Restart Leap Motion and Refresh Page.";document.body.appendChild(a);document.getElementsByClassName("leap_motion_connection")[0].addEventListener("click",function(){this.style.display=
"none"},!1);setTimeout(function(){a.remove()},2E4)}):console.error("Connection to Leap Motion Lost. Restart Leap Motion and Refresh Page.")}catch(a){console.error(a.message)}}}function R(){if("runtime"in chrome)try{chrome.runtime.sendMessage({tab_status:"current"},function(a){p=a.active&&window.location.href===a.url&&document.hasFocus()?!0:!1})}catch(a){-1===a.message.indexOf("Error connecting to extension")&&console.error(a.message)}else p=document.hasFocus()}function S(){y?(P(),R()):B(A)}function J(){if(m.fingers===
s){n=!1;v=document.createElement("style");v.setAttribute("type","text/css");v.appendChild(document.createTextNode(T));document.head.appendChild(v);var a=document.createElement("div"),b=document.createElement("div"),c,d;a.id="chrome-leap-fingercontainer";for(d=0;10>d;d+=1)c=b.cloneNode(!1),c.id="chrome-leap-finger"+(d+1),"rainbow"===m.color&&(c.style.cssText="background-color: "+U[d]+";"),c.className="chrome-leap-finger chrome-leap-finger-"+m.color,a.appendChild(c);f=document.createElement("div");
g=document.createElement("div");f.id="chrome-leap-scroll-down";g.id="chrome-leap-scroll-up";a.appendChild(f);a.appendChild(g);document.body.appendChild(a);h=document.getElementsByClassName("chrome-leap-finger");f=document.getElementById("chrome-leap-scroll-down");g=document.getElementById("chrome-leap-scroll-up")}A=L(S,1E3)}function K(){"storage"in chrome?chrome.storage.local.get(["leap_motion_fingers","leap_motion_color","leap_motion_scrolling","leap_motion_history"],function(a){var b,c;for(b in a)c=
b.substr(b.lastIndexOf("_")+1),m[c]=a[b];J()}):J()}var D="disabled",s="yes",p=!1,y=!0,t=null,u=0,I,z=null,A,Q=5,G=window.innerWidth,H=window.innerHeight,N=15,r=null,E=null,q=null,x=!0,d=20,U="#F80C12 #FF3311 #FF6644 #FEAE2D #D0C310 #69D025 #12BDB9 #4444DD #3B0CBD #442299".split(" "),h=[],n=!0,f,g,e=null,v,l,m={fingers:s,color:"rainbow",scrolling:"enabled",history:"enabled"},T=".leap_motion_connection {position: fixed;top: 0;left: 0;width: 100%;color: #222;text-align: center;height: 30px;z-index: 1000;line-height: 30px;background-color: #9AC847; }.chrome-leap-finger {width:"+
d+"px;height:"+d+"px;-webkit-border-radius: "+Math.ceil(d/2)+"px;border-radius: "+Math.ceil(d/2)+"px;position: fixed;z-index: 10000;opacity: 0;-webkit-transition: opacity 0.15s ease;transition: opacity 0.15s ease;-webkit-box-sizing: border-box;box-sizing: border-box;transform: translate3d(0,0,0); }.chrome-leap-finger-rainbow {-webkit-box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25);box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25); }.chrome-leap-finger-leap {background-color: #9AC847;-webkit-box-shadow: inset 0 0 5px #000;box-shadow: inner 0 0 5px #000; }.chrome-leap-finger-dark {background-color: #000000;-webkit-box-shadow: inset 0px 0px 1px 1px rgba(255, 255, 255, 0.5);box-shadow: inset 0px 0px 1px 1px rgba(255, 255, 255, 0.5); }.chrome-leap-finger-light {background-color: #FFFFFF;-webkit-box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25);box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.25) }#chrome-leap-scroll-up {display: none; position: fixed; top:0; left:0;width: 0; height: 0;opacity: 0.5;margin-left: "+
d/2/2+"px;border-left: "+d/2/2+"px solid transparent;border-right: "+d/2/2+"px solid transparent;border-bottom: "+d/2+"px solid #9AC847; }#chrome-leap-scroll-down {display: none; position: fixed; top:0; left:0;width: 0; height: 0;opacity: 0.5;margin-left: "+d/2/2+"px;border-left: "+d/2/2+"px solid transparent;border-right: "+d/2/2+"px solid transparent;border-top: "+d/2+"px solid #9AC847; }";w.prototype={angleTo:function(a){var b=this.magnitude()*a.magnitude();return 0<b?Math.acos(this.dot(a)/b):
0},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},magnitude:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}};K();"storage"in chrome&&chrome.storage.onChanged.addListener(K);(function(){window.addEventListener("resize",function(){G=window.innerWidth;H=window.innerHeight},!1);window.addEventListener("focus",function(){p=!0},!1);window.addEventListener("blur",function(){p=!1},!1)})();F()})();